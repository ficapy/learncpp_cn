# 使用集成调试器 单步调试



当你运行你的程序时，执行从main函数的顶部开始，然后顺序执行语句，直到结束。在你的程序运行的时候，程序都在跟踪很多事情：你正在使用的变量的值，哪些函数被调用了(这样当这些函数返回的时候，程序就会知道回到哪里去)，以及程序内的当前执行点(这样它就知道下一步要执行哪条语句)。所有这些被跟踪的消息都被称为你的程序状态(简称状态)。

在前面的课程中，我们探讨了改变代码以帮助调试的各种方法，包括打印诊断消息或者使用记录器。这些都是在程序运行时检查其状态的简单方法。虽然如果使用得当，这些方法是有效的，但是它们仍然有缺点：它们需要改变你的代码，这需要时间，而且可能会引入新的错误，而且它们使你的代码混乱，让现有的代码更难理解。

在我们到目前为止所展示的技术背后，有一个未声明的假设：一旦我们运行代码，它就会运行完成(只暂停接受输入)，我们没有机会在任何时候干预和检查程序的结果。

然而，如果我们能够移除这个假设呢？幸运的是，我们可以。大多数现代IDE都带有一个叫做调试器的集成工具，它正是为了完成这个任务而设计的。

# 调试器

`调试器`是一种计算机程序，它允许程序员控制程序的执行方式，并在程序运行时检查程序状态。比如，程序员可以使用调试器逐行执行程序，沿途检查变量的值。通过比较变量的实际值和预期值，或者观察代码的执行路径，调试器可以极大地帮助跟踪语义(逻辑)错误。

调试器背后的力量有两方面：一是能够精确控制程序的执行，二是能够查看(如果需要，还可以修改)程序的状态。

早期的调试器，比如[gdb](http://en.wikipedia.org/wiki/Gdb) 。是独立的程序，有命令行界面，程序员必须输入神秘的命令才能让它们工作。后来的调试器(比如Borland的turbo调试器的早期版本)仍然是独立的，但是有自己的“图形化”前端，使它们的工作更容易。现在大多数现代的IDE都有一个集成的调试器 --- 也就是说，调试器使用与编辑器相同的节目，所以你可以使用与你编写代码相同的环境进行调试(而不是必须切换程序)。

几乎所有的现代调试器都包含了相同的标准基本功能集 -- 然而，在访问这些功能的菜单如何安排上并不一致，键盘快捷键的一致性就更低了。虽然我们的例子会使用Visual Studio的截图(我们也会介绍如何在Code::Blocks中做这些事情)，但是无论你使用的是哪种开发环境，甚至是我们没有介绍的环境，你都应该不难找出如何访问我们讨论的每个功能。

本章的剩余部分将用来学习如何使用调试器。

### 提示

不要忽视学习使用调试器。随着你的程序变得越来越复杂，与你节省的查找和修复问题的时间相比，你花在学习有效使用集成调试器上的时间就显得微不足道了。

### 警告

在继续学习本课之前（以及后续和使用调试器相关的课程），请确保你的项目使用调试器配置进行编译(参考0.9节 -- 配置你的编译器--构建配置 章节)。如果你使用发布配置来编译你的项目，调试器的功能可能无法正常工作。

### 对于Code::Blocks用户

如果你使用的是Code::Blocks，你的调试器可能会或者不会被正确设置。让我们来检查一下。

首先，进入  设置菜单 -->> 调试器 -->> GDB/CDB debugger, 选择Default。应该打开以下对话框，看起来像这样

![img](https://blogimg.ficapy.com/learncpp/CB-DebuggingSetup-min.png)

如果你看到"可执行文件路径"的地方有一个大红条，那么你需要找到你的调试器。要做到这一点，点击“可执行路径”字段右边的按钮，在你的系统中找到gdb32.exe文件。存在于以下目录"*C:\Program Files (x86)\CodeBlocks\MinGW\bin\gdb32.exe*."。然后点击确定。

### 对于Code::Blocks用户

有报告称，Code::Blocks集成调试器(GDB)在识别一些包含空格或者非英文字符的路径时可能出现问题。如果你在学习这些课程的时候遇到问题，这可能是一个原因。

# 单步调试

我们要开始对调试器的探索，首先要研究一些调试工具，让我们能够控制程序的执行方式。

`Stepping`是一组相关调试器功能的名称，它让我们逐条语句执行我们的代码。

还有一些相关的单步命令，我们将依次介绍

# Step into

`Step into`命令执行程序正常执行路径中的下一条语句，然后暂停程序的执行，这样我们就可以使用调试器检查程序的状态。如果正在执行的语句中包含一个函数调用，step会让程序跳转到被调用函数的顶端，在那里暂停执行。

让我们来看看一个非常简单的程序：

```c++
#include <iostream>

void printValue(int value)
{
  std::cout << value << '\n';
}

int main()
{
  printValue(5);
  return 0;
}
```

让我们使用step into命令来调试这个程序。

